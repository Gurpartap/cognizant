#!/usr/bin/env ruby

# Set the process name.
$0 = File.basename(__FILE__)

# Flush standard output/error immediately.
$stdout.sync = true
$stderr.sync = true

begin
  require 'optparse'

  options = {
    socket: "/var/run/cognizant/cognizantd.sock"
  }

  OptionParser.new do |opts|
    opts.banner = <<-EOF
NAME
    cognizant - administration utility for cognizantd

SYNOPSIS:
    cognizant [global options] command [command options] [arguments...]

GLOBAL OPTIONS:
    EOF

    opts.on("-s FILE", "--socket FILE", String, "The socket lock file of the daemon server") do |value|
      options[:socket] = value
    end

    opts.on("-b ADDRESS", "--bind-address ADDRESS", String, "The server address of the daemon server.") do |value|
      options[:bind_address] = value
    end

    opts.on("-p PORT", "--port PORT", Integer, "The server port of the daemon server.") do |value|
      options[:port] = value
    end

    opts.on("--username USERNAME", String, "Username to use for authentication with server.") do |value|
      options[:username] = value
    end

    opts.on("--password PASSWORD", String, "Password to use for authentication with server.") do |value|
      options[:password] = value
    end

    opts.on("-t", "--trace", "Turn on tracing, enabling full backtrace.") do
      options[:trace] = true
    end

    opts.on("-v", "--version", "Print the version number and exit.") do
      require 'cognizant/version'
      $stdout.puts Cognizant::VERSION
      exit(0)
    end
  end.parse!

  require 'cognizant'
  Cognizant.add_process(options)
end
